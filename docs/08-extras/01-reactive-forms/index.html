<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>little angular book</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../normalize.css">
    <link rel="stylesheet" href="../../hljs-theme.css">
    <link rel="stylesheet" href="../../markdown.css">
    <link rel="stylesheet" href="../../main.css?v=2.0.0">
</head>
<body>
<a id="menu-toggle" class="menu-toggle" href="#" title="toggle menu">
    <span></span><span></span><span></span>
</a>
<div class="menu">
    
        <div class="menu-item depth-1 ">
             
            <a href="../../index.html">Little angular book</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../01-typescript/index.html">TypeScript</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/01-basic-types/index.html">Basic types</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/02-classes-interfaces/index.html">Classes and interfaces</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/03-functions/index.html">Functions</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/04-enums/index.html">Enums</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/05-advanced-types/index.html">Advanced types</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/06-decorators/index.html">Decorators</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/07-generics/index.html">Generics</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../02-components/index.html">Components</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/01-lifecycle-events/index.html">Lifecycle events</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/02-input-output/index.html">Input / Output</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/03-templates/index.html">Templates</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/01-raw-html/index.html">Raw HTML</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/02-data-flow/index.html">Data flow</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/03-class-style/index.html">Class &amp; style helpers</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/04-structural-directives/index.html">Structural directives</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/04-styles/index.html">Styles</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../03-routing/index.html">Routing</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../03-routing/01-parameters/index.html">Route parameters</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../03-routing/02-query-parameters/index.html">Query parameters</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../04-dependency-injection/index.html">Dependency injection</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/01-circumventing-di/index.html">Circumventing the DI system</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/02-sharing-services/index.html">Sharing services</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/03-providers/index.html">Providers</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../04-dependency-injection/03-providers/01-class-provider/index.html">Class provider</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../04-dependency-injection/03-providers/02-factory-provider/index.html">Factory provider</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../04-dependency-injection/03-providers/03-value-provider/index.html">Value provider</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/04-di-tricks/index.html">DI tricks</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../05-services/index.html">Services</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../06-testing/index.html">Testing</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../06-testing/01-jasmine/index.html">Jasmine </a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../06-testing/02-snippets/index.html">Snippets</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../06-testing/03-templates/index.html">Templates</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../07-observables/index.html">Observables</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../07-observables/01-examples/index.html">Examples</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../08-extras/index.html">Extras</a>
            
        </div>
    
        <div class="menu-item depth-3 selected">
            ▹
            <a href="../../08-extras/01-reactive-forms/index.html">Reactive forms</a>
            
                <div class="menu-section depth-4">
                    ◦
                    <a href="#1">
                        Example
                    </a>
                </div>
            
        </div>
    
</div>
<div class="markdown-body"><h1>Reactive forms</h1>
<ul>
<li>reactive forms are &quot;mostly set up&quot; in the component&#39;s <em>class</em> and not in the html <em>template</em></li>
<li>where the html form best practices meet with angular reactive forms things can get hairy (native form events, for example)</li>
<li>in my experience validation related checks (<em>dirty</em>, <em>pristine</em>, <em>valid</em>, <em>invalid</em>) are very finicky</li>
<li>route query handling is always a nice to have, but it&#39;s not exactly simple with Angular</li>
<li>use <code>new FormGroup</code> to form a group, and inside that use <code>new FormControl</code> to define a form control&#39;s behavior</li>
</ul>
<h2><a name="1">Example</a></h2>
<h3>Template</h3>
<ul>
<li>both <em>reset</em> and <em>submit</em> are unintuitive</li>
<li><code>[formGroup]</code> is used on the form,<br><code>formControlName</code> (without square brackets) is used on the input element</li>
<li>if a button has no proper type, than that will act as a submit button (standard html, but it&#39;s easy to forget)</li>
<li>if you want to support the traditional way of how forms work, then<ul>
<li>the submit event is <code>(ngSubmit)</code>, which is a wrapper around the real submit:<br>it prevents the form submit bubbling using <em>preventDefault</em> under the hood</li>
<li>the reset is <code>(reset)</code>, no special wrapper is needed, but the underlying code will need to be kept in sync</li>
</ul>
</li>
</ul>
<pre class="hljs"><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">&quot;searchForm&quot;</span> (<span class="hljs-attr">ngSubmit</span>)=<span class="hljs-string">&quot;onFormSubmit()&quot;</span> (<span class="hljs-attr">reset</span>)=<span class="hljs-string">&quot;onFormReset()&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">formControlName</span>=<span class="hljs-string">&quot;userName&quot;</span> [<span class="hljs-attr">style.backgroundColor</span>]=<span class="hljs-string">&quot;searchForm.controls.userName.dirty &amp;&amp; searchForm.controls.userName.errors ? &#x27;red&#x27; : &#x27;white&#x27;&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">&quot;searchForm.invalid&quot;</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;reset&quot;</span>&gt;</span>Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre><h3>Component class</h3>
<ul>
<li><code>ReactiveFormsModule</code> must be imported (this is a standalone component)</li>
<li>form submit and reset are using the default form behavior</li>
<li>query params:<ul>
<li>I&#39;m using activated route <em>snapshots</em>: for those to work a proper router must be set up (routes and a route outlet)</li>
<li>if all you want is to support page reloading (and NOT back/forward), then snapshots are enough</li>
<li>in this example I use <code>replaceUrl: true</code> which eliminates the history</li>
<li>if you want to support back/forward, then proper subscriptions are needed</li>
<li>I <em>do</em> subscribe to the queryParam change here, because if I have a link to this page,
then that will delete the query params from the url (so I can stay on the page, but I can loose the query params)</li>
</ul>
</li>
</ul>
<pre class="hljs"><code class="hljs language-typescript"><span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">&#x27;app-form&#x27;</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">&#x27;./form.component.html&#x27;</span>,
  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">CommonModule</span>, <span class="hljs-title class_">ReactiveFormsModule</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormComponent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnInit</span> {
  searchForm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormGroup</span>({
    <span class="hljs-attr">userName</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(<span class="hljs-string">&#x27;&#x27;</span>, [<span class="hljs-title class_">Validators</span>.<span class="hljs-property">required</span>]),
  });

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> activatedRoute = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ActivatedRoute</span>);
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> router = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">Router</span>);

  <span class="hljs-keyword">readonly</span> queryParamSubscriber = <span class="hljs-variable language_">this</span>.<span class="hljs-property">activatedRoute</span>.<span class="hljs-property">queryParams</span>.<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">takeUntilDestroyed</span>()).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">queryParams</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(queryParams).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchForm</span>.<span class="hljs-title function_">reset</span>();
  })

  <span class="hljs-title function_">ngOnInit</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">useQueryParams</span>();
  }

  <span class="hljs-title function_">onFormSubmit</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Submit form (dispatch event for effect, call api using a service, etc.)&#x27;</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateQueryParams</span>();
  }

  <span class="hljs-title function_">onFormReset</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchForm</span>.<span class="hljs-title function_">reset</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">updateQueryParams</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> queryParams = <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchForm</span>.<span class="hljs-title function_">getRawValue</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">router</span>.<span class="hljs-title function_">navigate</span>([], { queryParams, <span class="hljs-attr">relativeTo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">activatedRoute</span>, <span class="hljs-attr">replaceUrl</span>: <span class="hljs-literal">true</span> });
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">useQueryParams</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> params = <span class="hljs-variable language_">this</span>.<span class="hljs-property">activatedRoute</span>.<span class="hljs-property">snapshot</span>.<span class="hljs-property">queryParamMap</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchForm</span>.<span class="hljs-property">controls</span>.<span class="hljs-property">userName</span>.<span class="hljs-title function_">setValue</span>((params.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;userName&#x27;</span>) ?? <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">trim</span>());
  }
}
</code></pre></div>
<script src="../../main.js?v=2.0.0"></script>
</body>
</html>
