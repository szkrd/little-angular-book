<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>little angular book</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../normalize.css">
    <link rel="stylesheet" href="../../hljs-theme.css">
    <link rel="stylesheet" href="../../markdown.css">
    <link rel="stylesheet" href="../../main.css?v=2.0.0">
</head>
<body>
<a id="menu-toggle" class="menu-toggle" href="#" title="toggle menu">
    <span></span><span></span><span></span>
</a>
<div class="menu">
    
        <div class="menu-item depth-1 ">
             
            <a href="../../index.html">Little angular book</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../01-typescript/index.html">TypeScript</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/01-basic-types/index.html">Basic types</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/02-classes-interfaces/index.html">Classes and interfaces</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/03-functions/index.html">Functions</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/04-enums/index.html">Enums</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/05-advanced-types/index.html">Advanced types</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/06-decorators/index.html">Decorators</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../01-typescript/07-generics/index.html">Generics</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../02-components/index.html">Components</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/01-lifecycle-events/index.html">Lifecycle events</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/02-input-output/index.html">Input / Output</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/03-templates/index.html">Templates</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/01-raw-html/index.html">Raw HTML</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/02-data-flow/index.html">Data flow</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/03-class-style/index.html">Class &amp; style helpers</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../02-components/03-templates/04-structural-directives/index.html">Structural directives</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../02-components/04-styles/index.html">Styles</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../03-routing/index.html">Routing</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../03-routing/01-parameters/index.html">Route parameters</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../03-routing/02-query-parameters/index.html">Query parameters</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../04-dependency-injection/index.html">Dependency injection</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/01-circumventing-di/index.html">Circumventing the DI system</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/02-sharing-services/index.html">Sharing services</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/03-providers/index.html">Providers</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../04-dependency-injection/03-providers/01-class-provider/index.html">Class provider</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../04-dependency-injection/03-providers/02-factory-provider/index.html">Factory provider</a>
            
        </div>
    
        <div class="menu-item depth-4 ">
            ▪
            <a href="../../04-dependency-injection/03-providers/03-value-provider/index.html">Value provider</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../04-dependency-injection/04-di-tricks/index.html">DI tricks</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../05-services/index.html">Services</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../06-testing/index.html">Testing</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../06-testing/01-jasmine/index.html">Jasmine </a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../06-testing/02-snippets/index.html">Snippets</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../06-testing/03-templates/index.html">Templates</a>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../07-observables/index.html">Observables</a>
            
        </div>
    
        <div class="menu-item depth-3 selected">
            ▹
            <a href="../../07-observables/01-examples/index.html">Examples</a>
            
                <div class="menu-section depth-4">
                    ◦
                    <a href="#1">
                        Download from api
                    </a>
                </div>
            
                <div class="menu-section depth-4">
                    ◦
                    <a href="#2">
                        Consecutive ajax calls
                    </a>
                </div>
            
                <div class="menu-section depth-4">
                    ◦
                    <a href="#3">
                        Parallel ajax calls
                    </a>
                </div>
            
                <div class="menu-section depth-4">
                    ◦
                    <a href="#4">
                        Computed observable
                    </a>
                </div>
            
        </div>
    
        <div class="menu-item depth-2 ">
            ▸
            <a href="../../08-extras/index.html">Extras</a>
            
        </div>
    
        <div class="menu-item depth-3 ">
            ▹
            <a href="../../08-extras/01-reactive-forms/index.html">Reactive forms</a>
            
        </div>
    
</div>
<div class="markdown-body"><h1>Examples</h1>
<h2><a name="1">Download from api</a></h2>
<p>Let&#39;s download a list of my repositories and print the ones starting with the letter <em>&quot;A&quot;</em>. See how we have no ngOnInit, because the <code>async pipe</code> render &quot;triggers a subscription&quot;. </p>
<p>Since the response is <em>one</em> array with lot&#39;s of objects, we use <code>map</code> in the pipe and not <code>filter</code>.</p>
<p>In a &quot;real&quot; angular app we would use the angular&#39;s http service in our own service.</p>
<pre class="hljs"><code class="hljs language-typescript"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/core&#x27;</span>;
<span class="hljs-keyword">import</span> {ajax} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs/ajax&#x27;</span>;
<span class="hljs-keyword">import</span> {map} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs/operators&#x27;</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Observable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs&#x27;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRepo</span> { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; }

<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">&#x27;app-github-repos&#x27;</span>,
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let repo of repos$ | async&quot;&gt;{{ repo.name }}&lt;/li&gt;
    &lt;/ul&gt;
  `</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GithubReposComponent</span> {
  <span class="hljs-attr">repos$</span>: <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">IRepo</span>[]&gt;;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">repos$</span> = ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&#x27;https://api.github.com/users/szkrd/repos&#x27;</span>)
      .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">repos</span>: <span class="hljs-title class_">IRepo</span>[]</span>) =&gt;</span> repos.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">repo</span> =&gt;</span> <span class="hljs-regexp">/^a.*/</span>.<span class="hljs-title function_">test</span>(repo.<span class="hljs-property">name</span>))));
  }
}
</code></pre><h2><a name="2">Consecutive ajax calls</a></h2>
<p>Get JSON from url-1, <em>then</em> use a value from that response to download data from url-2.</p>
<pre class="hljs"><code class="hljs language-typescript">ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">&#x27;/movie/top_rated&#x27;</span>)).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">tap</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Number of top rated items:&#x27;</span>, data.<span class="hljs-property">results</span>.<span class="hljs-property">length</span>)),
  <span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> data.<span class="hljs-property">results</span>[<span class="hljs-number">0</span>]),
  <span class="hljs-title function_">tap</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Selected first movie:&#x27;</span>, data.<span class="hljs-property">id</span>, data.<span class="hljs-property">title</span>)),
  <span class="hljs-comment">// &quot;switch to a new observable&quot;</span>
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">`/movie/<span class="hljs-subst">${data.id}</span>`</span>)))
)
</code></pre><h2><a name="3">Parallel ajax calls</a></h2>
<p>Here the observable returns responses as they arrive:</p>
<pre class="hljs"><code class="hljs language-typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">urls</span>: <span class="hljs-built_in">string</span>[] = ids.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> <span class="hljs-title function_">url</span>(<span class="hljs-string">`/movie/<span class="hljs-subst">${id}</span>`</span>));
<span class="hljs-keyword">const</span> concurrentCalls = <span class="hljs-number">5</span>;
<span class="hljs-keyword">return</span> <span class="hljs-title function_">from</span>(urls).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">mergeMap</span>(ajax.<span class="hljs-property">getJSON</span>, concurrentCalls)
);
</code></pre><h3>Parallel ajax calls merged</h3>
<p>Similar to <code>Promise.all</code>, download two jsons and then convert the array into a nicer object:</p>
<pre class="hljs"><code class="hljs language-typescript"><span class="hljs-title function_">zip</span>(
  ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">&#x27;/movie/top_rated&#x27;</span>)),
  ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">&#x27;/discover/movie&#x27;</span>))
).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[topRated, discovered]: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> ({
    <span class="hljs-attr">topRated</span>: topRated.<span class="hljs-property">results</span>,
    <span class="hljs-attr">discovered</span>: discovered.<span class="hljs-property">results</span>
  })),
);
</code></pre><p>Just like Promise.all, this will fail if any of the calls fails.
To continue even then, add an error handler:</p>
<pre class="hljs"><code class="hljs language-typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onError</span> = (<span class="hljs-params"><span class="hljs-attr">err</span>: <span class="hljs-built_in">any</span></span>) =&gt; { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err); <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(err); };
<span class="hljs-keyword">return</span> <span class="hljs-title function_">zip</span>(
  ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">&#x27;/movie/top_rated&#x27;</span>)).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">catchError</span>(onError)),
  ajax.<span class="hljs-title function_">getJSON</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">&#x27;/discover/movie&#x27;</span>)).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">catchError</span>(onError)),
)<span class="hljs-comment">//.pipe(...</span>
</code></pre><h2><a name="4">Computed observable</a></h2>
<p>Add two numbers (a$ and b$) using the two observables&#39; latest value:<br><code>combineLatest</code> will create an array <code>[a, b]</code> then we pipe &amp; map that to <code>arr[0] + arr[1]</code></p>
<pre class="hljs"><code class="hljs language-typescript"><span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">&#x27;app-add&#x27;</span>,
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;p&gt;
      &lt;label&gt;A &lt;input type=&quot;number&quot; (change)=&quot;updateA($event)&quot; [value]=&quot;a$ | async&quot;&gt;&lt;/label&gt;
      +
      &lt;label&gt;B &lt;input type=&quot;number&quot; (change)=&quot;updateB($event)&quot; [value]=&quot;b$ | async&quot;&gt;&lt;/label&gt;
      = {{sum$ | async}}
    &lt;/p&gt;
  `</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddComponent</span> {
  a$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BehaviorSubject</span>(-<span class="hljs-number">10</span>);
  b$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BehaviorSubject</span>(<span class="hljs-number">10</span>);
  sum$ = <span class="hljs-title function_">combineLatest</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a$</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">b$</span>).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x[<span class="hljs-number">0</span>] + x[<span class="hljs-number">1</span>]));
  <span class="hljs-title function_">updateA</span>(<span class="hljs-params">$event</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">a$</span>.<span class="hljs-title function_">next</span>(<span class="hljs-built_in">parseInt</span>($event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>, <span class="hljs-number">10</span>)); }
  <span class="hljs-title function_">updateB</span>(<span class="hljs-params">$event</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">b$</span>.<span class="hljs-title function_">next</span>(<span class="hljs-built_in">parseInt</span>($event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>, <span class="hljs-number">10</span>)); }
}
</code></pre></div>
<script src="../../main.js?v=2.0.0"></script>
</body>
</html>
